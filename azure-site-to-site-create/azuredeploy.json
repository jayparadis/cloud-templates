chema":
"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
"contentVersion":
"1.0.0.0",
"parameters":
{
"azureVNetAddressPrefix":
{
"defaultValue":
"10.3.0.0/16",
"metadata":
{
"description":
"CIDR block representing the address space of the Azure VNet"
},
"type":
"string"
},
"connectionName":
{
"defaultValue":
"Azure2Other",
"metadata":
{
"description":
"Arbitrary name for the new connection between Azure VNet and other network"
},
"type":
"string"
},
"gatewayName":
{
"defaultValue":
"azureGateway",
"metadata":
{
"description":
"Arbitrary name for the new gateway"
},
"type":
"string"
},
"gatewayPublicIPName":
{
"defaultValue":
"azureGatewayIP",
"metadata":
{
"description":
"Arbitrary name for public IP resource used for the new azure gateway"
},
"type":
"string"
},
"gatewaySku":
{
"metadata":
{
"description":
"The Sku of the Gateway. This must be one of Basic, Standard or HighPerformance."
},
"type":
"string"
},
"gatewaySubnetPrefix":
{
"defaultValue":
"10.3.200.0/29",
"metadata":
{
"description":
"CIDR block for gateway subnet, subset of azureVNetAddressPrefix address space"
},
"type":
"string"
},
"localAddressPrefix":
{
"defaultValue":
"192.168.0.0/16",
"metadata":
{
"description":
"CIDR block representing the address space of the OnPremise VPN network's Subnet"
},
"type":
"string"
},
"localGatewayIpAddress":
{
"defaultValue":
"1.1.1.1",
"metadata":
{
"description":
"Public IP of your StrongSwan Instance"
},
"type":
"string"
},
"localGatewayName":
{
"defaultValue":
"localGateway",
"metadata":
{
"description":
"Arbitrary name for gateway resource representing "
},
"type":
"string"
},
"sharedKey":
{
"metadata":
{
"description":
"Shared key (PSK) for IPSec tunnel"
},
"type":
"securestring"
},
"subnetName":
{
"defaultValue":
"Subnet1",
"metadata":
{
"description":
"Arbitrary name for the Azure Subnet"
},
"type":
"string"
},
"subnetPrefix":
{
"defaultValue":
"10.3.1.0/24",
"metadata":
{
"description":
"CIDR block for VM subnet, subset of azureVNetAddressPrefix address space"
},
"type":
"string"
},
"virtualNetworkName":
{
"defaultValue":
"azureVnet",
"metadata":
{
"description":
"Arbitrary name for the Azure Virtual Network"
},
"type":
"string"
},
"vpnType":
{
"allowedValues":
[
"RouteBased",
"PolicyBased"
],
"defaultValue":
"RouteBased",
"metadata":
{
"description":
"Route based or policy based"
},
"type":
"string"
}
},
"resources":
[
{
"apiVersion":
"[variables('api-version')]",
"location":
"[resourceGroup().location]",
"name":
"[parameters('localGatewayName')]",
"properties":
{
"gatewayIpAddress":
"[parameters('localGatewayIpAddress')]",
"localNetworkAddressSpace":
{
"addressPrefixes":
[
"[parameters('localAddressPrefix')]"
]
}
},
"type":
"Microsoft.Network/localNetworkGateways"
},
{
"apiVersion":
"[variables('api-version')]",
"dependsOn":
[
"[concat('Microsoft.Network/virtualNetworkGateways/', parameters('gatewayName'))]",
"[concat('Microsoft.Network/localNetworkGateways/', parameters('localGatewayName'))]"
],
"location":
"[resourceGroup().location]",
"name":
"[parameters('connectionName')]",
"properties":
{
"connectionType":
"IPsec",
"localNetworkGateway2":
{
"id":
"[resourceId('Microsoft.Network/localNetworkGateways', parameters('localGatewayName'))]"
},
"routingWeight":
10,
"sharedKey":
"[parameters('sharedKey')]",
"virtualNetworkGateway1":
{
"id":
"[resourceId('Microsoft.Network/virtualNetworkGateways', parameters('gatewayName'))]"
}
},
"type":
"Microsoft.Network/connections"
},
{
"apiVersion":
"[variables('api-version')]",
"location":
"[resourceGroup().location]",
"name":
"[parameters('virtualNetworkName')]",
"properties":
{
"addressSpace":
{
"addressPrefixes":
[
"[parameters('azureVNetAddressPrefix')]"
]
},
"subnets":
[
{
"name":
"[parameters('subnetName')]",
"properties":
{
"addressPrefix":
"[parameters('subnetPrefix')]"
}
},
{
"name":
"GatewaySubnet",
"properties":
{
"addressPrefix":
"[parameters('gatewaySubnetPrefix')]"
}
}
]
},
"type":
"Microsoft.Network/virtualNetworks"
},
{
"apiVersion":
"[variables('api-version')]",
"location":
"[resourceGroup().location]",
"name":
"[parameters('gatewayPublicIPName')]",
"properties":
{
"publicIPAllocationMethod":
"Dynamic"
},
"type":
"Microsoft.Network/publicIPAddresses"
},
{
"apiVersion":
"[variables('api-version')]",
"dependsOn":
[
"[concat('Microsoft.Network/publicIPAddresses/', parameters('gatewayPublicIPName'))]",
"[concat('Microsoft.Network/virtualNetworks/', parameters('virtualNetworkName'))]"
],
"location":
"[resourceGroup().location]",
"name":
"[parameters('gatewayName')]",
"properties":
{
"enableBgp":
"false",
"gatewayType":
"Vpn",
"ipConfigurations":
[
{
"name":
"vnetGatewayConfig",
"properties":
{
"privateIPAllocationMethod":
"Dynamic",
"publicIPAddress":
{
"id":
"[resourceId('Microsoft.Network/publicIPAddresses',parameters('gatewayPublicIPName'))]"
},
"subnet":
{
"id":
"[variables('gatewaySubnetRef')]"
}
}
}
],
"sku":
{
"name":
"[parameters('gatewaySku')]",
"tier":
"[parameters('gatewaySku')]"
},
"vpnType":
"[parameters('vpnType')]"
},
"type":
"Microsoft.Network/virtualNetworkGateways"
}
],
"variables":
{
"api-version":
"2015-06-15",
"gatewaySubnetRef":
"[concat(variables('vnetID'),'/subnets/','GatewaySubnet')]",
"subnetRef":
"[concat(variables('vnetID'),'/subnets/',parameters('subnetName'))]",
"vnetID":
"[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworkName'))]"
}
}
